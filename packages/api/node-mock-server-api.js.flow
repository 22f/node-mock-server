// @flow

import type { $MethodEnumType } from 'node-mock-server-utils';


// RESPONSE
export type ResponseConstructorType = {
	src: string,
	endpointId: string,
	methodId: $MethodEnumType,
	responseId: string,
};

export type ResponseJsonType = {
	response: string,
	responseId: string,
	status: number,
	data: ?string,
};

// METHOD
export type StoreFileJsonType = {
	desc: string,
	desc2?: string,
	security?: Array<string>,
	protected: boolean,
	status?: string,
	request: Object,
	endpoint: string,
	method: $MethodEnumType,
	responses: ?Array<{
		statusCode?: string | number,
		schema?: {
			type?: string,
		},
	}>,
};

export type MethodConstructorType = {
	src: string,
	endpointId: string,
	methodId: $MethodEnumType,
};

export type MethodJsonType = {
	method: $MethodEnumType,
	methodId: $MethodEnumType,
	desc: string,
	desc2: string,
	responses: Array<{ name: string, id: string }>,
};

export type MethodMinJsonType = {
	method: $MethodEnumType,
	methodId: $MethodEnumType,
	desc: string,
};

// ENDPOINT
export type EndpointConstructorType = {
	endpointId: string,
	src: string,
};

export type EndpointJsonType = {
	endpoint: string,
	endpointId: string,
	methods: Array<$MethodEnumType>,
};

export type EndpointDetailedJsonType = {
	endpoint: string,
	endpointId: string,
	methods: Array<MethodMinJsonType>,
};

export type EndpointCreateDataType = {
	endpoint: string,
	desc?: string,
	method?: string,
};

export type MethodCreateDataType = {
	method: string,
	desc?: string
};

// ENDPOINTS
export type EndpointsConstructorType = {
	src: string,
};

declare module 'node-mock-server-api' {

	declare export type $EndpointDetailedJsonType = EndpointDetailedJsonType;
	declare export type $EndpointDetailedJsonMethodEntryType = MethodMinJsonType;
	declare export type $EndpointJsonType = EndpointJsonType;
	declare export type $EndpointCreateDataType = EndpointCreateDataType;
	declare export type $MethodCreateDataType = MethodCreateDataType;
	declare export type $MethodJsonType = MethodJsonType;


	declare export class Response {
		src: string;
		endpointId: string;
		methodId: $MethodEnumType;
		response: string;
		responseId: string;
		status: number;
		data: ?string;

		constructor(options: ResponseConstructorType): void;
		getData(): ?string;
		updateResponse(data: string): boolean;
		toJson(): ResponseJsonType;
	}

	declare export class Method {
		src: string;
		endpointId: string;
		methodId: $MethodEnumType;
		responses: Array<Response>;
		responsesById: {[key: string]: Response};

		constructor(options: MethodConstructorType): void,
		getResponses(): Array<Response>,
		getResponse(responseId: string): Response,
		createResponse(responseId: string, data: string): boolean,
		toJson(): $MethodJsonType,
	}

	declare export class Endpoint {
		src: string,
		endpoint: string,
		endpointId: string,
		methods: Array<$MethodEnumType>,
		methodsById: {[key: $MethodEnumType]: Method},

		constructor(options: EndpointConstructorType): void,
		getMethods(): Array<Method>,
		getMethod(methodId: $MethodEnumType): Method,
		createMethod(options: $MethodCreateDataType): ?Method,
		removeMethod(methodId: $MethodEnumType): boolean,
		toJson(): $EndpointJsonType,
		toDetailedJson(): EndpointDetailedJsonType,
	}

	declare export class Endpoints {
		src: string,
		endpoints: Array<Endpoint>,
		endpointsById: {[key: string]: Endpoint},

		constructor(options: EndpointsConstructorType): void,
		getEndpoints(): Array<Endpoint>,
		getEndpoint(endpointId: string): Endpoint,
		getEndpointsAsJson(): Array<$EndpointJsonType>,
		getDetailedEndpointsAsJson(): Array<EndpointDetailedJsonType>,
		createEndpoint(data: $EndpointCreateDataType): Endpoint,
		removeEndpoint(endpointId: string): boolean,
	}

	declare export default Endpoints;
}
